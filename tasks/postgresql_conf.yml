--- 
- name: Create conf.d
  file: path={{ pg_conf }}/conf.d state=directory owner=postgres group=postgres

- name: Set conf.d include in postgresql.conf
  lineinfile: 
      regexp: "^#?include_dir" 
      line: "include_dir = 'conf.d'"
      dest: "{{ pg_conf }}/postgresql.conf"
      backup: yes
  notify: restart postgres

- name: Template configs(25ansible_postgresql.conf)
  template: 
      src: 25ansible_postgresql.conf.j2
      dest: "{{ pg_conf }}/conf.d/25ansible_postgresql.conf"
      owner: "{{ postgresql_admin_user }}"
      group: "{{ postgresql_admin_user }}"
      backup: yes
  notify: reload postgres
  # Reload instead of restart. Check_restart.yml task was added to notify if postmaster scoped configs are modified.

# flush removed. we dont expect service to be RESTARTED during playbook run. and it'll gonn to be STARTED in start.yml task
#- meta: flush_handlers
